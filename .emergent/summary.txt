<analysis>
The primary language of the user is Czech (čeština). The next agent MUST respond in Czech.

This trajectory details an extensive and complex debugging session to deploy new features (blog, comments, AAS Verified status) for an ASP.NET Core application. The initial implementation was complete, but deployment failed repeatedly due to Entity Framework (EF) Core migration issues.

The AI engineer's process was a deep dive into troubleshooting:
1.  Initial attempts to apply migrations manually failed due to environment limitations (no SDK in the production image) or were rejected by the user who demanded a robust, automated solution.
2.  Investigation revealed multiple layers of problems:
    *   **Structural Issues:** Two separate migration folders existed ( and ), causing EF Core to miss the new migrations.
    *   **Naming & Order Issues:** Several migration files had invalid, non-timestamped filenames or incorrect years, causing EF Core to ignore them or process them out of order.
    *   **Missing Designer Files:** The most critical issue was that the new migration files lacked their corresponding  files, making them invalid to EF Core.
3.  The AI attempted to regenerate the migrations using a temporary SDK container. This process was plagued by its own set of problems, including package version incompatibilities, Docker networking issues, and database authentication errors.
4.  Ultimately, the migrations were regenerated, but one () was created empty.
5.  The final state involved manually creating the missing tables (, ) and adding the missing column () with raw SQL as a workaround. The application now starts without crashing, but the root cause of the faulty migration generation process remains unresolved.
</analysis>

<product_requirements>
The goal is to expand the Aristocratic Artwork Sale application with a blog system, a user comment feature for artwork collections, and an AAS Verified badge for collections.

**Implementation Summary:**
-   **Features Developed:** Data models (, ), controllers, and Razor views for the blog and comment functionalities were created. The  model was updated to include an  property.
-   **Core Problem:** The primary challenge has been the deployment of these features. The automatic Entity Framework Core migrations, which are supposed to update the database schema, have been consistently failing. This has led to a series of runtime  errors (e.g., ) because the application code is out of sync with the database.
-   **User Requirement:** The user has explicitly stated that the migration process must be automated and stable for future updates, rejecting manual, one-off SQL fixes as a long-term solution. The recent manual fixes were a temporary measure to get the application running.
</product_requirements>

<key_technical_concepts>
- **Framework:** ASP.NET Core 8.0 (MVC, Razor Views)
- **Database:** PostgreSQL with Entity Framework Core
- **ORM / Migrations:** Deeply problematic EF Core migration setup. Key issues involved discovery, naming conventions (), the necessity of  files, and consolidation of multiple migration directories.
- **Containerization:** Docker & Docker Compose
- **Web Server:** Nginx (Reverse Proxy)
- **Troubleshooting:** Manual migration regeneration using a temporary .NET SDK container, manual SQL execution, Docker build cache invalidation ().
</key_technical_concepts>

<code_architecture>
The application is a monolithic ASP.NET Core project containerized with Docker. The core of the recent issues revolves around the Entity Framework Core migration files.

**Directory Structure (Relevant Portion):**


**File Analysis & Changes:**

-   ** (Folder)**
    -   **Summary:** This folder is the consolidated location for all EF Core migrations. It was discovered that a second, incorrect folder () was previously used, causing new migrations to be ignored. All migrations were moved here.
    -   **Changes:** Multiple files within this directory were renamed to follow the  convention. Invalid, older migration files without  counterparts were deleted.

-   ** & **
    -   **Summary:** This is a regenerated, valid migration to add , , and  columns.
    -   **Changes:** These files were newly generated via  to replace older, invalid migration files that were missing their designer counterparts and had incorrect filenames.

-   ****
    -   **Summary:** This migration was intended to create the  and  tables. It is the source of the final problem.
    -   **Changes:** This file was generated via , but its  and  methods were found to be **empty**. This meant that although EF Core marked the migration as applied, it performed no actions, and the tables were never created. This was ultimately fixed with a manual SQL script.
    

-   ****
    -   **Summary:** This file contains the application's startup logic, including the code to automatically apply EF Core migrations.
    -   **Changes:** No changes were made, but it was heavily scrutinized to confirm that the  call was present, which it was. The issue was not with this file, but with the invalid migration files it was trying to process.

-   ****
    -   **Summary:** Defines the multi-stage Docker build process.
    -   **Changes:** The build was forced to run with  to ensure the latest source code changes (especially in the  folder) were included in the final image, as cached layers were causing old, broken code to be deployed.
</code_architecture>

<pending_tasks>
- **Fix Migration Generation:** The root cause of the empty  migration needs to be investigated and fixed to ensure  generates correct code in the future. The manual SQL was a patch, not a permanent solution.
- **Complete Localization:** Add missing translation keys to all RESX files for the new blog and comment features.
- **Implement DeepL Service:** The  is registered but not yet used. It needs to be integrated for content translation as originally planned.
</pending_tasks>

<current_work>
The immediate focus was resolving a critical deployment failure where the application crashed on startup due to an out-of-sync database. The root cause was a cascade of Entity Framework Core migration issues, culminating in the discovery that a key migration file () was generated with empty  and  methods.

**Summary of Final Actions:**
1.  **Manual Column Creation:** The  column, which was also missing, was manually added to the  table via a direct SQL  command.
2.  **Manual Table Creation:** The  and  tables were manually created using a direct  SQL script inside the PostgreSQL container, as the responsible migration was empty.
3.  **Rebuild & Restart:** The Docker image was rebuilt with  to ensure all source code corrections were included, and the application container was restarted.

**Current Status:**
The application now starts successfully without any immediate crash logs. The database schema has been manually forced into alignment with the application's models. However, the automated migration system that caused this entire cascade of failures has not been fully fixed, as evidenced by the empty migration file that was generated. The system is running but is in a fragile state regarding future schema changes.
</current_work>

<optional_next_step>
Zkontroluji logy, abych se ujistil, že se po manuální opravě databáze neobjevují žádné nové chyby, a potvrdím, že aplikace je plně funkční.
</optional_next_step>
